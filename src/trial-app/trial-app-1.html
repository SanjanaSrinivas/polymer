<script src="/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="/bower_components/app-layout/app-layout.html">
<link rel="import" href="/bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="/bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="/bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="/bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="/bower_components/app-layout/demo/sample-content.html">
<link rel="import" href="/bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="/bower_components/paper-progress/paper-progress.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/polymer/lib/utils/gestures.html">
<link rel="import" href="/bower_components/paper-card/paper-card.html"> 
<link rel="import" href="/bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="/bower_components/resizable-panels/resizable-panels.html">
<link rel="import" href="/bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="/bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="/bower_components/iron-collapse-button/iron-collapse-button.html">
<link rel="import" href="/bower_components/polymer/elements/dom-repeat.html">
<!--
<link rel="import" href="/bower_components/paper-styles/color.html">
<link rel="import" href="/bower_components/paper-styles/typography.html">
-->

<dom-module id="trial-app-1">
  <template>
    <custom-style>
        <style is="custom-style">
          html, body {
            margin: 0;
            font-family: 'Roboto', 'Noto', sans-serif;
            -webkit-font-smoothing: antialiased;
            background: #f1f1f1;
            max-height: 368px;
          }
          app-toolbar {
            background-color: #4285f4;
            color: #fff;
          }
      
          paper-icon-button {
            --paper-icon-button-ink-color: white;
          }
      
          /* app-header {
            @apply --layout-fixed-top;
            color: #fff;
            --app-header-background-rear-layer: {
              background-color: #ef6c00;
            };
          } */
          
          #main-content{
            display: flex;
          }
          #narrative-views{
            border-width: 2px;
            border-style:solid;
            border-color: chocolate;
            margin-top: 0px;
            margin-right: 0px;
            display: list-item;
            padding: 20px;
          }
          #narrative-editor{
            border-style: dotted;
            border-width: 4px;
            border-color: coral;
            margin-top: 0px;
            margin-left: 0px;
            width: 500px;
            position: fixed;
          }
          sample-content {
            padding-top: 64px;
          }
          
          paper-card{
            color: black;
            width: 100%;
          }
          paper-tooltip{
            --paper-tooltip-delay-in: 500;
            font-size: 12pt;
          }
          .panel { 
            padding: 20px; 
            color: white; 
            width: 100%;
            height: 100%;
            /* max-width: 100%; */
          }
          .p1 { 
            background-color: white; 
            width: 100%;
            /* height: 100%; */
            /* max-width: 100%;  */
            /* overflow-y: scroll; */
          }
          .p2 { 
            background-color: beige; 
            width: 50%;
            /* height: 100%; */
            /* max-width: 50%  */
          }
          .card-body{
            margin:20px;
          }
          paper-card {
            margin-bottom: 10px;
          }
      </style>
    </custom-style>

    <app-header-layout>
      <app-header>
        <app-toolbar>
          DANA: DAta NArratives
        </app-toolbar>
      </app-header>

      <resizable-panels>
        <div class="panel p1" id="view">
          <dom-repeat items="{{narratives}}">
            <template>
                <paper-card>
                    <paper-toolbar on-click="toggleCollapse" identity$="{{index}}">
                        <div slot="top" id="cardtooltip" class="title">{{item.title}}</div>
                    </paper-toolbar>
                    <paper-tooltip id="cardtooltip" for="cardtitle" position="top">{{item.tooltip_text}}</paper-tooltip>
                    <iron-collapse identity$="{{index}}">
                      <!-- <iron-collapse id="collapse"+> -->

                     
                      <div class="card-body">
                        <!-- <div class="card-body"> -->
                          <div class="card-actions" >
                              <div class="horizontal justified">
                                  <paper-button on-click="openEditor" identity$="{{index}}">Edit</paper-button>
                                  <paper-button on-click="seeMore" identity$="{{index}}">See More</paper-button>
                                  <paper-button on-click="seeLess" identity$="{{index}}">See Less</paper-button>
                              </div>
                          </div>
                          
                          <div class="card-content" identity$="{{index}}">{{item.text}}</div>
                          <!-- <div class="card-content">{{narrative.text}}</div> -->
                      </div>
                        
                    </iron-collapse>
                    
                        
                  </paper-card>
            </template>
          </dom-repeat>

          <!-- <paper-card id="viewone">
            <paper-toolbar on-click="_toggleCollapse">
                <div slot="top" class="title" id="cardtitle">{{narratives.title}}</div>
            </paper-toolbar>
            <paper-tooltip id="cardtooltip" for="cardtitle" position="top">{{narratives.tooltip_text}}</paper-tooltip>
            <iron-collapse id="collapse">
              <div id="card-body">
                  <div class="card-actions" >
                      <div class="horizontal justified">
                          <paper-button on-click="openEditor">Edit</paper-button>
                          <paper-button on-click="seeMore" data-args="#viewone">See More</paper-button>
                          <paper-button on-click="seeLess" data-args="#viewone">See Less</paper-button>
                      </div>
                  </div>
                  
                  <div class="card-content" id="cardcontent">{{narratives.text}}</div>
              </div>
                
            </iron-collapse> -->
            
                
          <!-- </paper-card> -->

          

          </div>
          <div class="panel p2" id="editor" hidden$="{{hideEditor}}">
              <paper-card id="editor">
                  <paper-toolbar>
                      <div slot="top" class="title">Narrative Editor</div>
                  </paper-toolbar>
                  <div class="card-actions">
                      <div class="horizontal justified">
                          <paper-button on-click="editLinkMode">Edit Links</paper-button>
                          <paper-button on-click="editTextMode">Edit Text</paper-button>
                          <paper-button on-click="recordEdits">Record Edits</paper-button>
                          <paper-button on-click="closeEditor">Close</paper-button>
                      </div>
                  </div>

                  <div class="card-content" id="editorarea"></div>
                
              </paper-card>
              
          </div>
        </resizable-panels>

    </app-header-layout>
   
   
  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
     
  

    class TrialApp1 extends Polymer.Element {
      static get is() { return 'trial-app-1'; }
      
      static get properties(){
        return {
          hideEditor: {
            type: Boolean,
            value: true
          },
          narratives: {
            type: Array,
            value: []
          },
          narrativeToEdit: {
            type: Number,
            value: -1
          },
          editStateDictionary: {
            value: {
              0: "editor closed",
              1: "editor opened",
              2: "edit links",
              3: "edit text",
              4: "recorded edits"
            }
          },
          editState: {
            type: Number,
            value: 0
          }
        };
        
      }
      seeLess(e){
        // Old way
        // var cardid = e.target.getAttribute('data-args');
        // var card = Polymer.dom(this.root).querySelector(cardid);
        // $(card).find(".see").hide();

        var identity = e.target.getAttribute('identity');
        var div = Polymer.dom(this.root).querySelector('.card-content[identity="'+identity+'"]');
        $(div).find('.see').hide();
      }
      seeMore(e){
        // Old way
        // var cardid = e.target.getAttribute('data-args');
        // var card = Polymer.dom(this.root).querySelector(cardid);
        // $(card).find(".see").show(); 

        var identity = e.target.getAttribute('identity');
        var div = Polymer.dom(this.root).querySelector('.card-content[identity="'+identity+'"]');
        $(div).find('.see').show();
      }
      openEditor(e){
        // Old way
        // if(this.hide == true){
        //   this.$.editor.style.width = "50%";
        //   this.$.view.style.width = "50%";
        //   this.$.editorarea.innerHTML = this.$.cardcontent.innerHTML;
        //   this.hide = false;
        // }
        // alert(this.editState);
        var identity = e.target.getAttribute('identity');
        if(this.narrativeToEdit != -1){
          console.log('Some other narrative is blocking');
          return;
        }
        if(this.hideEditor == true){
          this.narrativeToEdit = identity;
          this.editState = 1;
          Polymer.dom(this.root).querySelector('#editor').style.width = "50%";
          Polymer.dom(this.root).querySelector('#view').style.width = "50%";
          Polymer.dom(this.root).querySelector('#editorarea').innerHTML = Polymer.dom(this.root).querySelector('.card-content[identity="'+identity+'"]').innerHTML;
          this.hideEditor = false;
        }  
        // alert(this.editState);
      }
      closeEditor(){
        // Old way
        // if(this.hideEditor == false){
        //   this.hideEditor = true;
        //   this.$.editorarea.innerHTML = "";
        //   this.$.view.style.width = "100%"; 
        // }
        
        if(this.hideEditor == false){
          Polymer.dom(this.root).querySelector('#editorarea').innerHTML = "";
          this.narrativeToEdit = -1;
          Polymer.dom(this.root).querySelector('#view').style.width = "";
          Polymer.dom(this.root).querySelector('#editor').style.width = "";
          this.hideEditor = true;
        }

      }
      toggleCollapse(e) {
        var identity = e.target.getAttribute('identity');
        var div = Polymer.dom(this.root).querySelector('.card-content[identity="'+identity+'"]');
        $(div).html(this.narratives[identity].text);
        Polymer.dom(this.root).querySelector('iron-collapse[identity="'+identity+'"]').toggle();
      
      }
      editLinkMode() {
        var a = this.$.editor;
        $(a).find("a").css("background-color", "khaki");
        
        
      }
      editTextMode() {
        var a = this.$.editor;
        $(a).find("a").css("background-color", "");
      }
      recordEdits() {

      }
      ready(){
        super.ready();
        var _self = this;
        $.get("/src/trial-app/data_narratives.json", function(data){
          // _self.$.cardtitle.innerHTML= data[0].title;
          // _self.$.cardcontent.innerHTML = data[0].text;
          // _self.$.cardtooltip.innerHTML = data[0].tooltip_text;
          _self.narratives = data;
          // $(_self.$.cardcontent).html(data[0].text);
        });
      }
        
    }
    

    window.customElements.define(TrialApp1.is, TrialApp1);
  </script>
</dom-module>
